<!DOCTYPE html>
<html xmlns:ng="http://angularjs.org" id="ng-app" ng-app="box">
    <head>
        <meta charset='utf-8' />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
        <title>Backupbox.se</title>
        <link href="/static/css/bootstrap/bootstrap.css" rel="stylesheet">
        <link href="/static/css/bootstrap/bootstrap-responsive.css" rel="stylesheet">
        <link href="/static/css/box.css" rel="stylesheet">
		<link rel="icon" type="image/png" href="/static/images/icons/favicon.ico">        
        <!--[if lte IE 8]>
        <script src="/static/js/ie/json2.js"></script>
        <![endif]-->
	<style>
	{% if islocal == false %}
	  .jumbotron {
	  	background-color: #2a00ff;
		box-shadow: 0px 10px 0px #2705d1;
	  }
	{% endif %}
	</style>
    </head>
    <body>
        <header class="jumbotron">
            <div class="container">
                <h1 class="logo"><a href="#" title="Backupbox.se">Backupbox.se</a><a class="box-info icon-white icon-info-sign" href="/info" target="_blank"></a></h1>				
				<div style="display: none" id="progressContainer" class="progress-container">
					Cloud backup progress<div class="progress">
					  <div id="cloudbackupprogress" class="progress-bar" role="progressbar" aria-valuenow="" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
					    
					  </div>
					</div>
				</div>
            </div>
        </header>
        {% raw %}
        <div ng-app="box">
            <div ui-view></div>
        </div>
        {% endraw %}
        <script type="text/javascript" src="/static/js/jquery/jquery.js"></script>
        <script type="text/javascript" src="/static/js/jquery.sticky.js"></script>
        <script type="text/javascript" src="/static/js/jquery.viewport.js"></script>
        <script type="text/javascript" src="/static/js/bootstrap/bootstrap.js"></script>
        <script type="text/javascript" src="/static/js/angular/angular.js"></script>
        <script type="text/javascript" src="/static/js/angular/angular-resource.js"></script>
        <script type="text/javascript" src="/static/js/angular/angular-ui-router.js"></script>
        <script type="text/javascript" src="/static/js/angular/ng-infinite-scroll.js"></script>
        <script type="text/javascript" src="/static/js/angular/sinon-chai.js"></script>
        <script type="text/javascript" src="/static/js/angular/sinon.js"></script>
        <script type="text/javascript" src="/static/js/angular/angular-sanitize.min.js"></script>
        <script type="text/javascript" src="/static/js/box.js"></script>
        <script type="text/javascript" src="/static/js/datebar.js"></script>
        <script>
			var uploadComplete = false; 
			var progressInterval; 
			
			$( document ).ready(function() {
				loadCloudBackupProgress();
				progressInterval = setInterval(function(){loadCloudBackupProgress()}, 10000);
			});

        	function loadCloudBackupProgress() {
        		if(!uploadComplete) {
					$.getJSON( "/lastping", function( data ) {
					  var items = [];
					  $.each( data, function( key, val ) {
					    items[key] = val; //.push( "<li id='" + key + "'>" + val + "</li>" );
					  });
					 
					  var remote_devicecount = items["remote_devicecount"];
					  var devicecount = items["devicecount"];
					  var progress = Math.round((remote_devicecount/devicecount)*100);
					  $("#cloudbackupprogress").html(progress+"%");
					  $("#cloudbackupprogress").attr("aria-valuenow", progress);
					  
					  if(progress == 100) {
						  uploadComplete = true; 
						  clearInterval(progressInterval);
						  $("#progressContainer").show();
						  $("#progressContainer").css("padding-top", "20px");
						  $("#progressContainer").html("All of your data is 100% safe in the cloud.");
					  } else {
						  var progressWidth = progress; 
						  if(progressWidth < 15) {
							  progressWidth = 15;
						  }
						  $("#cloudbackupprogress").css("width", progressWidth+"%");
						  $("#progressContainer").show();						  
					  }					  
					});
				}
			}
        </script>
    </body>
</html>

